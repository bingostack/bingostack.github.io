<!doctype html><html class="theme-next mist use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css"><meta name="keywords" content="openstack,ci,rpmbuild,rpm,yum,"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1"><meta name="description" content="在生产环境下，未确保软件版本的可靠及软件的稳定性，我们一般不使用源码安装软件。一般会根据os的不同，选择apt-get或yum安装软件。本文主要讲解如何使用rpmbuild工具制作rpm包。并以Openstack为例，讲述了Openstack打包的过程。
RPM基础知识本节主要分析是什么以及为什么的问题。以及常用的rpm和yum命令。
RPM包管理是什么？RPM全称是RedHat Package"><meta property="og:type" content="article"><meta property="og:title" content="rpmbuild实战"><meta property="og:url" content="http://stackeye.com/2014/08/rpmbuild-in-action/index.html"><meta property="og:site_name" content="StackEye"><meta property="og:description" content="在生产环境下，未确保软件版本的可靠及软件的稳定性，我们一般不使用源码安装软件。一般会根据os的不同，选择apt-get或yum安装软件。本文主要讲解如何使用rpmbuild工具制作rpm包。并以Openstack为例，讲述了Openstack打包的过程。
RPM基础知识本节主要分析是什么以及为什么的问题。以及常用的rpm和yum命令。
RPM包管理是什么？RPM全称是RedHat Package"><meta property="og:updated_time" content="2016-07-20T12:43:11.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="rpmbuild实战"><meta name="twitter:description" content="在生产环境下，未确保软件版本的可靠及软件的稳定性，我们一般不使用源码安装软件。一般会根据os的不同，选择apt-get或yum安装软件。本文主要讲解如何使用rpmbuild工具制作rpm包。并以Openstack为例，讲述了Openstack打包的过程。
RPM基础知识本节主要分析是什么以及为什么的问题。以及常用的rpm和yum命令。
RPM包管理是什么？RPM全称是RedHat Package"><script type="text/javascript" id="hexo.configuration">var NexT=window.NexT||{},CONFIG={scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:0,author:"博主"}}</script><link rel="canonical" href="http://stackeye.com/2014/08/rpmbuild-in-action/"><title> rpmbuild实战 | StackEye</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?9c95a77f4ec2c33edff8095251aef97d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">StackEye</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Long way to full stack!</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline"> rpmbuild实战</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time itemprop="dateCreated" datetime="2014-08-19T20:40:01+08:00" content="2014-08-19">2014-08-19</time></span> <span class="post-category">&nbsp; | &nbsp;<span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span> <span class="post-comments-count">&nbsp; | &nbsp;<a href="/2014/08/rpmbuild-in-action/#comments" itemprop="discussionUrl"><span class="post-comments-count ds-thread-count" data-thread-key="2014/08/rpmbuild-in-action/" itemprop="commentsCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p>在生产环境下，未确保软件版本的可靠及软件的稳定性，我们一般不使用源码安装软件。一般会根据os的不同，选择apt-get或yum安装软件。<br>本文主要讲解如何使用rpmbuild工具制作rpm包。并以Openstack为例，讲述了Openstack打包的过程。</p><h2 id="RPM基础知识"><a href="#RPM基础知识" class="headerlink" title="RPM基础知识"></a>RPM基础知识</h2><p>本节主要分析是什么以及为什么的问题。<br>以及常用的rpm和yum命令。</p><h3 id="RPM包管理是什么？"><a href="#RPM包管理是什么？" class="headerlink" title="RPM包管理是什么？"></a>RPM包管理是什么？</h3><p>RPM全称是RedHat Package Manager，是红帽系Linux默认使用的软件管理方法。主要包括centos、fedora、rhel等Linux分支。<br>其格式为Linux标准（LSB），是数据库驱动的包管理解决方案。<br>配合软件源，在centos系操作系统下，使用yum命令（最新版本应该是逐渐向dnf过渡）可以很容易的解决软件安装时的版本依赖问题。</p><h3 id="为什么使用RPM包管理？"><a href="#为什么使用RPM包管理？" class="headerlink" title="为什么使用RPM包管理？"></a>为什么使用RPM包管理？</h3><p>RPM包管理的优点如下：</p><ul><li>易于分发，安装、卸载、升级</li><li>自动依赖跟踪，结合yum自动解决依赖问题</li><li>自带包验证，保证安装的正确性</li><li>保存软件包安装的一致性</li><li>易于保持对系统安装包的跟踪管理</li></ul><h3 id="基本RPM命令"><a href="#基本RPM命令" class="headerlink" title="基本RPM命令"></a>基本RPM命令</h3><p>我们可以直接使用rpm命令，对软件包进行一些操作。</p><ul><li>安装<br><code>rpm –ivh &lt;package_name&gt;</code><br><code>--nodeps</code>忽略依赖问题，一般仅用于测试<a id="more"></a></li><li><p>卸载<br><code>rpm –e &lt;package_name&gt;</code><br>有其它包依赖此RPM包时，卸载会报错</p></li><li><p>升级<br>升级时使用-ivh会提示文件冲突<br><code>rpm –Uvh &lt;package_name&gt;</code> 没有安装过，则安装<br><code>rpm –Fvh &lt;package_name&gt;</code> 没有安装过，则忽略</p></li><li><p>查找<br><code>rpm –q[option] &lt;package name&gt;</code><br>-q 仅查询是否安装<br>-qi 列出软件包的详细信息<br>-ql 列出软件包的目录及文件<br>-qf 列出文件对应的安装包<br>-qa 列出所有已安装的软件包<br>-qp 列出未安装的RPM包的信息</p></li><li><p>验证<br>对已安装的包进行文件校验：<br><code>rpm –V &lt;package_name&gt;</code><br><code>rpm -Vp &lt;rpm_file&gt;</code><br><code>rpm -Va</code><br>导入key：<br><code>rpm --import &lt;RPM_KEY&gt;</code><br>在包安装之前进行签名校验：<br><code>rpm -K &lt;rpm_&gt;file</code></p></li><li><p>重建数据库<br><code>rpm –rebuilddb</code> 解决系统RPM数据库的异常</p></li></ul><h3 id="基本YUM命令"><a href="#基本YUM命令" class="headerlink" title="基本YUM命令"></a>基本YUM命令</h3><p>yum其实是透明的调用rpm，相当于在rpm基础上封装的更易使用的“前端”。<br>它主要设计来解决软件包之间的依赖性，并可从多个资源库（我们称之为“源”，典型的由<code>/etc/yum.repos.d/</code>目录下的每个.repo文件定义）。</p><ul><li>源制作<br><code>createrepo &lt;dir&gt;</code><br>一般的centos系的iso镜像中，都带有安装时使用的rpm包。可以将这部分文件mount到本地，创建本地源，以减少软件安装时的上网下载。</li><li>安装<br><code>yum install &lt;package_name&gt; -y</code><br><code>yum localinstall &lt;rpm_file&gt;</code> 本地安装<br><code>yum groupinstall &lt;group_name&gt;</code> 组安装</li><li>升级<br><code>yum update [package_name]</code></li><li>卸载<br><code>yum remove/erase &lt;package_name&gt;</code><br>谨慎使用: 此命令会卸载掉所有依赖此包的RPM包</li><li>查找<br><code>yum search &lt;name&gt;</code><br><code>yum list|grep</code></li><li><p>本地缓存相关<br><code>yum makecache</code> 只做本地缓存<br><code>yum clean all</code> 清除本地缓存</p></li><li><p>repo文件格式<br>一个典型的repo文件格式如下：</p><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">[repo-name]</div><div class="line">name=repo-name</div><div class="line">baseurl=http://yourserver.com/path/to/repo</div><div class="line">enabled=1</div><div class="line">gpgcheck=0</div></pre></td></tr></table></figure></li></ul><h2 id="RPM-Build相关知识"><a href="#RPM-Build相关知识" class="headerlink" title="RPM Build相关知识"></a>RPM Build相关知识</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><ol><li>软件包安装<br><code>yum install rpm-build -y</code></li><li>创建目录<br>~/rpmbuild: 默认使用主目录下的rpmbuild目录<br>~/rpmbuild/SPECS: 存放spec文件<br>~/rpmbuild/SOURCES : 存放源代码等source文件<br>~/rpmbuild/RPMS : 存放RPM包<br>~/rpmbuild/BUILD和~/rpmbuild/BUILDROOT: 存放build中间文件</li></ol><h3 id="rpmbuild命令"><a href="#rpmbuild命令" class="headerlink" title="rpmbuild命令"></a>rpmbuild命令</h3><p><code>rpmbuild –ba</code> 编译二进制及源RPM包<br><code>rpmbuild –bb</code> 仅编译二进制RPM包<br><code>rpmbuild –bs</code> 仅编译源RPM包<br>编译后的二进制RPM包在<code>~/rpmbuild/RPMS/&lt;arch&gt;</code>目录下，如<code>~/rpmbuild/RPMS/noarch</code>。<br>源RPM包在<code>~/rpmbuild/SRPMS/</code>下。</p><h3 id="Build准备"><a href="#Build准备" class="headerlink" title="Build准备"></a>Build准备</h3><ul><li>源码包<br>按SPEC文件中指定名称，放在SOURCES文件夹下</li><li>patch、init脚本<br>按SPEC文件中指定名称，放在SOURCES文件夹下</li><li>SPEC文件<br>放在SPECS文件夹下</li></ul><h2 id="SPEC文件语法"><a href="#SPEC文件语法" class="headerlink" title="SPEC文件语法"></a>SPEC文件语法</h2><p>spec文件内容主要：</p><ul><li>指定编译、安装源码的过程</li><li>编译和生成RPM包指令的集合</li><li>指定RPM包的内容及信息</li></ul><p>语法与shell类似，也可直接使用shell命令。</p><h3 id="Spec文件分为不同的节"><a href="#Spec文件分为不同的节" class="headerlink" title="Spec文件分为不同的节"></a>Spec文件分为不同的节</h3><p>不同的节用于不同的阶段，分别用于完成不同功能。<br>主要分为以下几个阶段：</p><ul><li>Preamble</li><li>Setup</li><li>Build</li><li>Install</li><li>Clean</li><li>Files</li><li>Changelog</li></ul><h3 id="Preamble"><a href="#Preamble" class="headerlink" title="Preamble"></a>Preamble</h3><p>此节主要用于初始化，定义RPM包的特性：</p><ul><li>Name/Version/Group/License</li><li>Release信息：BUILD版本号</li><li>Sources/Patches：编译时使用的源代码及patch</li><li>Requirements：使用Requires、BuildRequires指定依赖包及版本。</li><li>Summary/Description</li><li>其它自定义属性</li></ul><h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>通过解压源码包等方式，生成需要的源码树<br>对源码进行patch等操作<br>build之前的所有其它操作，如删除不需要的文件<br>例子：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">%prep #定义prep节开始</div><div class="line">%setup –q #解压Source0</div><div class="line">%patch0 –p1 #对源码包使用patch0</div></pre></td></tr></table></figure><p></p><h3 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h3><p>编译二进制文件<br>可以使用%configure指定build时需要加入的参数<br>举例：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">%build</div><div class="line">%configure</div><div class="line">%&#123;__python&#125; setup.py build #python编译</div><div class="line">make %&#123;?_smp_mflags&#125; #C语言等使用make编译</div></pre></td></tr></table></figure><p></p><h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><p>创建BUILDROOT目录<br>在BUILDROOT中创建需要的目录结构<br>将编译后的文件安装在BUILDROOT对应位置<br>清理不需要的文件<br>可以通过<code>%pre/%post/%preun/%postun</code>分别指定安装前、安装后、卸载前、卸载后要执行的动作。</p><p>举例：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">%install  #执行python setup.py install进行安装，跳过编译阶段</div><div class="line"> %&#123;__python&#125; setup.py install -O1 --skip-build --root %&#123;buildroot&#125; #在%&#123;_sharedstatedir&#125;这个宏指定的目录下安装文件夹hello，并指定权限</div><div class="line"> install -d -m 755 %&#123;buildroot&#125;%&#123;_sharedstatedir&#125;/cinder</div><div class="line"> %pre</div><div class="line"> %post</div><div class="line"> %preun</div><div class="line">%postun</div></pre></td></tr></table></figure><p></p><h3 id="Clean"><a href="#Clean" class="headerlink" title="Clean"></a>Clean</h3><p>清理资源，如移除BUILDROOT目录<br>举例：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">%clean</div><div class="line">rm –rf %&#123;buildroot&#125;</div></pre></td></tr></table></figure><p></p><h3 id="Files"><a href="#Files" class="headerlink" title="Files"></a>Files</h3><p>指定所有RPM安装的文件<br>Install但未指定的文件，会报错<br>举例：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">%files</div><div class="line">%defattr(-, cinder, cinder, -) #指定权限</div><div class="line">#已安装的文件，注意与install处不同，文件前无%&#123;buildroot&#125;</div><div class="line">%dir %&#123;_sharedstatedir&#125;/cinder</div></pre></td></tr></table></figure><p></p><h3 id="Changelog"><a href="#Changelog" class="headerlink" title="Changelog"></a>Changelog</h3><p>用于跟踪spec文件的修改记录<br>应该在每次修改后增加相关记录<br>举例：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">%changelog</div><div class="line">* Fri May 16 2014 Fansp &lt;wangbin@awcloud.com&gt; - 2014.1-15</div><div class="line">Make a demo</div><div class="line">* Mon Apr 21 2014 Eric Harney &lt;eharney@redhat.com&gt; - 2014.1-2</div><div class="line">- Remove qpid settings from cinder-dist.conf</div></pre></td></tr></table></figure><p></p><h3 id="常用的宏"><a href="#常用的宏" class="headerlink" title="常用的宏"></a>常用的宏</h3><p>使用宏，而不是指定绝对路径，增加灵活性。因为不同系统中，使用不同系统路径，spec文件无需修改。<br>内置宏定义在 /usr/lib/rpm/macros文件中。同时支持自定义宏。<br></p><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="comment"># Built-in macros</span></div><div class="line"> %_prefix /usr  </div><div class="line"> %_<span class="built_in">exec</span>_prefix %&#123;_prefix&#125;  </div><div class="line"> %_bindir %&#123;_<span class="built_in">exec</span>_prefix&#125;/bin  </div><div class="line"> %_sbindir %&#123;_<span class="built_in">exec</span>_prefix&#125;/sbin  </div><div class="line"> %_libexecdir %&#123;_<span class="built_in">exec</span>_prefix&#125;/libexec  </div><div class="line"> %_datadir %&#123;_prefix&#125;/share  </div><div class="line"> %_sysconfdir %&#123;_prefix&#125;/etc  </div><div class="line"> %_sharedstatedir %&#123;_prefix&#125;/com  </div><div class="line"> %_localstatedir %&#123;_prefix&#125;/var  </div><div class="line"> %_libdir %&#123;_<span class="built_in">exec</span>_prefix&#125;/lib  </div><div class="line"> %_includedir %&#123;_prefix&#125;/include  </div><div class="line"> %_oldincludedir /usr/include  </div><div class="line"> %_infodir %&#123;_prefix&#125;/info  </div><div class="line"> %_mandir %&#123;_prefix&#125;/man</div></pre></td></tr></table></figure><p></p><h2 id="RPM-Build最佳实践建议"><a href="#RPM-Build最佳实践建议" class="headerlink" title="RPM Build最佳实践建议"></a>RPM Build最佳实践建议</h2><p>总结的一些经验教训：</p><ul><li>对于源码需要的修改，使用patch，而不是RPM Hacks</li><li>避免脚本，减少pre/post的使用，逻辑尽量放在代码中</li><li>使用Changelog或版本控制，便于查找及维护</li><li>避免使用root用户制作RPM包</li><li>在Fedora/EPEL中查找现成RPM包、SPEC文件</li></ul><h2 id="Openstack-RPM制作"><a href="#Openstack-RPM制作" class="headerlink" title="Openstack RPM制作"></a>Openstack RPM制作</h2><h3 id="打包前准备"><a href="#打包前准备" class="headerlink" title="打包前准备"></a>打包前准备</h3><p>编写需要的SPEC文件及init脚本。或使用已有的SRPM包，如通过RDO：<a href="https://repos.fedorapeople.org/repos/openstack/" target="_blank" rel="external">https://repos.fedorapeople.org/repos/openstack/</a>。</p><ol><li>解压SRPM找到spec文件，放在SPECS目录下</li><li>找到其他source文件，放在SOURCES目录下</li><li>Git clone代码，压缩为SPEC文件指定的名称，放在SOURCES目录下</li><li>按需修改各文件<br><code>rpmbuild –ba &lt;spec_file&gt;</code></li><li>安装RPM包进行测试</li></ol><h3 id="以Nova为例"><a href="#以Nova为例" class="headerlink" title="以Nova为例"></a>以Nova为例</h3><ul><li>SPEC文件<br>openstack-nova.spec</li><li>SOURCES<br>nova-2014.1.3.tar.gz<br>.init及.upstart文件，conf及logrotate等文件</li><li>需要的patch</li><li>rpmbuild<br><code>rpmbuild –ba openstack-nova.spec</code></li><li>按照RDO文档依次安装RPM包搭建环境进行测试</li></ul><h3 id="各组件对应spec文件"><a href="#各组件对应spec文件" class="headerlink" title="各组件对应spec文件"></a>各组件对应spec文件</h3><ul><li>nova - openstack-nova.spec</li><li>Neutron - openstack-neutron.spec</li><li>Keystone - openstack-keystone.spec</li><li>Glance - openstack-glance.spec</li><li>Cinder - openstack-cinder.spec</li><li>Swift - openstack-swift.spec</li><li>Horizon - python-django-horizon.spec</li></ul><h2 id="参考索引"><a href="#参考索引" class="headerlink" title="参考索引"></a>参考索引</h2><ul><li><p>Fedora官网文档：<br><a href="http://fedoraproject.org/wiki/Packaging/Guidelines" target="_blank" rel="external">http://fedoraproject.org/wiki/Packaging/Guidelines</a><br><a href="http://fedoraproject.org/wiki/Packaging/ReviewGuidelines" target="_blank" rel="external">http://fedoraproject.org/wiki/Packaging/ReviewGuidelines</a></p></li><li><p>Maximum RPM:<br><a href="http://www.rpm.org/max-rpm-snapshot/" target="_blank" rel="external">http://www.rpm.org/max-rpm-snapshot/</a></p></li><li><p>RDO仓库：<br><a href="https://repos.fedorapeople.org/repos/openstack/" target="_blank" rel="external">https://repos.fedorapeople.org/repos/openstack/</a></p></li><li><p>《鸟哥的Linux私房菜》：<br><a href="http://vbird.dic.ksu.edu.tw/linux_basic/0520rpm_and_srpm.php" target="_blank" rel="external">http://vbird.dic.ksu.edu.tw/linux_basic/0520rpm_and_srpm.php</a></p></li></ul></div><div></div><div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/openstack/" rel="tag">#openstack</a> <a href="/tags/ci/" rel="tag">#ci</a> <a href="/tags/rpmbuild/" rel="tag">#rpmbuild</a> <a href="/tags/rpm/" rel="tag">#rpm</a> <a href="/tags/yum/" rel="tag">#yum</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2014/06/openstack-ci/" rel="next" title="Openstack CI持续集成测试简介"><i class="fa fa-chevron-left"></i> Openstack CI持续集成测试简介</a></div><div class="post-nav-prev post-nav-item"> <a href="/2016/07/fresh-start/" rel="prev" title="新域名启用">新域名启用<i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"><div class="jiathis_style"><a class="jiathis_button_tsina"></a><a class="jiathis_button_tqq"></a><a class="jiathis_button_weixin"></a><a class="jiathis_button_cqq"></a><a class="jiathis_button_douban"></a><a class="jiathis_button_renren"></a><a class="jiathis_button_qzone"></a><a class="jiathis_button_kaixin001"></a><a class="jiathis_button_copy"></a><a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script></div></div></div><div class="comments" id="comments"><div class="ds-thread" data-thread-key="2014/08/rpmbuild-in-action/" data-title="rpmbuild实战" data-url="http://stackeye.com/2014/08/rpmbuild-in-action/"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/img/avatar.jpg" alt="Jacob"><p class="site-author-name" itemprop="name">Jacob</p><p class="site-description motion-element" itemprop="description">软件工程师的自我修养</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">23</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories"><span class="site-state-item-count">4</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags"><span class="site-state-item-count">28</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#RPM基础知识"><span class="nav-number">1.</span> <span class="nav-text">RPM基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RPM包管理是什么？"><span class="nav-number">1.1.</span> <span class="nav-text">RPM包管理是什么？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为什么使用RPM包管理？"><span class="nav-number">1.2.</span> <span class="nav-text">为什么使用RPM包管理？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基本RPM命令"><span class="nav-number">1.3.</span> <span class="nav-text">基本RPM命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基本YUM命令"><span class="nav-number">1.4.</span> <span class="nav-text">基本YUM命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RPM-Build相关知识"><span class="nav-number">2.</span> <span class="nav-text">RPM Build相关知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#环境搭建"><span class="nav-number">2.1.</span> <span class="nav-text">环境搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rpmbuild命令"><span class="nav-number">2.2.</span> <span class="nav-text">rpmbuild命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Build准备"><span class="nav-number">2.3.</span> <span class="nav-text">Build准备</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SPEC文件语法"><span class="nav-number">3.</span> <span class="nav-text">SPEC文件语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spec文件分为不同的节"><span class="nav-number">3.1.</span> <span class="nav-text">Spec文件分为不同的节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Preamble"><span class="nav-number">3.2.</span> <span class="nav-text">Preamble</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Setup"><span class="nav-number">3.3.</span> <span class="nav-text">Setup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Build"><span class="nav-number">3.4.</span> <span class="nav-text">Build</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install"><span class="nav-number">3.5.</span> <span class="nav-text">Install</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Clean"><span class="nav-number">3.6.</span> <span class="nav-text">Clean</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Files"><span class="nav-number">3.7.</span> <span class="nav-text">Files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Changelog"><span class="nav-number">3.8.</span> <span class="nav-text">Changelog</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常用的宏"><span class="nav-number">3.9.</span> <span class="nav-text">常用的宏</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RPM-Build最佳实践建议"><span class="nav-number">4.</span> <span class="nav-text">RPM Build最佳实践建议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Openstack-RPM制作"><span class="nav-number">5.</span> <span class="nav-text">Openstack RPM制作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#打包前准备"><span class="nav-number">5.1.</span> <span class="nav-text">打包前准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#以Nova为例"><span class="nav-number">5.2.</span> <span class="nav-text">以Nova为例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#各组件对应spec文件"><span class="nav-number">5.3.</span> <span class="nav-text">各组件对应spec文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考索引"><span class="nav-number">6.</span> <span class="nav-text">参考索引</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2012 - <span itemprop="copyrightYear">2016</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Jacob</span></div><div class="powered-by"> 由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动</div><div class="theme-info"> 主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script><script type="text/javascript">var duoshuoQuery={short_name:"stackeye"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.id="duoshuo-script",t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script><script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script><script src="/js/src/hook-duoshuo.js"></script></body></html>
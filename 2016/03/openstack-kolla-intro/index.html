<!doctype html><html class="theme-next mist use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css"><meta name="keywords" content="docker,openstack,kolla,容器化,"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1"><meta name="description" content="Kolla是Openstack的容器化部署项目。
本文主要对Kolla项目进行简单介绍，对其诞生的意义、内部的大概实现做出介绍，以便于读者快速理解项目以投入使用、快速进行自定义开发。
以下主要针对Kolla的Mitaka版本。开始写这篇文章时，Mitaka还尚未发布，因此使用的其实是master版本。
为什么要做容器化部署Openstack之美参考下图，OpenStack的架构设计是很漂亮的：清晰"><meta property="og:type" content="article"><meta property="og:title" content="Kolla：Openstack容器化部署简介"><meta property="og:url" content="http://stackeye.com/2016/03/openstack-kolla-intro/index.html"><meta property="og:site_name" content="StackEye"><meta property="og:description" content="Kolla是Openstack的容器化部署项目。
本文主要对Kolla项目进行简单介绍，对其诞生的意义、内部的大概实现做出介绍，以便于读者快速理解项目以投入使用、快速进行自定义开发。
以下主要针对Kolla的Mitaka版本。开始写这篇文章时，Mitaka还尚未发布，因此使用的其实是master版本。
为什么要做容器化部署Openstack之美参考下图，OpenStack的架构设计是很漂亮的：清晰"><meta property="og:image" content="http://stackeye.com/img/the-beauty-of-openstack.png"><meta property="og:image" content="http://stackeye.com/img/the-reality-of-openstack.png"><meta property="og:image" content="http://stackeye.com/img/docker-background.png"><meta property="og:image" content="http://stackeye.com/img/docker-internal.png"><meta property="og:image" content="http://stackeye.com/img/docker-stages.png"><meta property="og:image" content="http://stackeye.com/img/ansible-arch.png"><meta property="og:image" content="http://stackeye.com/img/ansible-best-practise.png"><meta property="og:image" content="http://stackeye.com/img/kolla-arch.png"><meta property="og:updated_time" content="2016-07-29T01:52:49.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Kolla：Openstack容器化部署简介"><meta name="twitter:description" content="Kolla是Openstack的容器化部署项目。
本文主要对Kolla项目进行简单介绍，对其诞生的意义、内部的大概实现做出介绍，以便于读者快速理解项目以投入使用、快速进行自定义开发。
以下主要针对Kolla的Mitaka版本。开始写这篇文章时，Mitaka还尚未发布，因此使用的其实是master版本。
为什么要做容器化部署Openstack之美参考下图，OpenStack的架构设计是很漂亮的：清晰"><meta name="twitter:image" content="http://stackeye.com/img/the-beauty-of-openstack.png"><script type="text/javascript" id="hexo.configuration">var NexT=window.NexT||{},CONFIG={scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:0,author:"博主"}}</script><link rel="canonical" href="http://stackeye.com/2016/03/openstack-kolla-intro/"><title> Kolla：Openstack容器化部署简介 | StackEye</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?9c95a77f4ec2c33edff8095251aef97d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">StackEye</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Long way to full stack!</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline"> Kolla：Openstack容器化部署简介</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time itemprop="dateCreated" datetime="2016-03-15T09:18:18+08:00" content="2016-03-15">2016-03-15</time></span> <span class="post-category">&nbsp; | &nbsp;<span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a></span></span> <span class="post-comments-count">&nbsp; | &nbsp;<a href="/2016/03/openstack-kolla-intro/#comments" itemprop="discussionUrl"><span class="post-comments-count ds-thread-count" data-thread-key="2016/03/openstack-kolla-intro/" itemprop="commentsCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p><a href="https://github.com/openstack/kolla" target="_blank" rel="external">Kolla</a>是Openstack的容器化部署项目。</p><p>本文主要对Kolla项目进行简单介绍，对其诞生的意义、内部的大概实现做出介绍，以便于读者快速理解项目以投入使用、快速进行自定义开发。</p><p>以下主要针对Kolla的Mitaka版本。开始写这篇文章时，Mitaka还尚未发布，因此使用的其实是master版本。</p><h2 id="为什么要做容器化部署"><a href="#为什么要做容器化部署" class="headerlink" title="为什么要做容器化部署"></a>为什么要做容器化部署</h2><h3 id="Openstack之美"><a href="#Openstack之美" class="headerlink" title="Openstack之美"></a>Openstack之美</h3><p>参考下图，OpenStack的架构设计是很漂亮的：清晰定义的服务，完美的原子操作，独立运行的可能，组件尽量无状态易于扩展。这是一个几乎做到极致的分布式架构。<br><img src="/img/the-beauty-of-openstack.png" alt="the beauty of openstack"></p><h3 id="Openstack之殇"><a href="#Openstack之殇" class="headerlink" title="Openstack之殇"></a>Openstack之殇</h3><p>但是现实是残酷的：</p><ul><li>服务之间往往有严重的依赖，使得部署复杂，修改麻烦，服务的管理困难；</li><li>配置复杂，有时候可能仅仅是一个微小的配置错误，就会导致整个集群功能异常；</li><li>而且随着OpenStack的发展，架构及配置只会越来越复杂。</li></ul><p>运维成本很高，效率低，严重影响了使用体验。<br><a id="more"></a><br><img src="/img/the-reality-of-openstack.png" alt="The Reality of OpenStack"><br>生产环境一旦部署完成很难去做大的升级。所以虽然每半年社区更新一个版本（目前马上M版本），但是真正生产环境可能还是I甚至E版本。对于每个组件，只做微小bug的升级，而且升级流程会非常谨慎。对于私有云产品也许还可以，但对于有大量用户严格SLA的公有云产品这是无法容忍的。这也是为什么说Openstack厂商离AWS、阿里云甚至UCloud这些大的公有云厂商还有很大的距离。<br>举个例子，如果我们要升级keystone这个基础组件——它是Openstack的认证组件，负载整个Openstack集群的鉴权，因此非常重要。<br>我们首先需要去判断这个版本的keystone和环境中使用的其它组件的当前版本是否完全兼容。而事实证明官方文档介绍很少，也是靠不住的，社区等着你发现bug做贡献呢；开发人员做出的估计有些也是不靠谱的，可以自行统计下每个组件的代码量；甚至简单的测试都不足够可靠，用例库也是逐渐总结出来的。这也说明了引入灰度上线和回滚机制是很有必要的。但是以现有的运维工具，回滚比较困难而且代价很大。因此一般在升级前都要做严格的升级测试，会有资源和人力的成本。</p><h3 id="容器的崛起"><a href="#容器的崛起" class="headerlink" title="容器的崛起"></a>容器的崛起</h3><p>虽然使用已有的一些OpenStack自动化部署工具，如puppet、fuel等，但往往只能部分解决这些问题，如不支持回滚、太重而导致资源浪费、体积太大速度缓慢等。<br>而docker在解决所有这些问题上具有很大的优势：</p><ul><li>服务直接的相互隔离</li><li>轻量级，节省资源，体积小便捷易携带迁移</li><li>容易描述的运行时关系</li><li>容易升级回滚，可灰度上线，对服务完整的生命周期管理</li><li>不只局限于OpenStack，对其它服务如HA等也适用</li><li>而通过与Kubernetes、服务发现等容器技术栈的高级工具组合，能提供更强大的解决方案</li></ul><p>当然还有容器的火爆发展，OpenStack社区怎么可能错过。</p><p><strong>下图对以上所有做了个很好的总结：</strong><br><img src="/img/docker-background.png" alt="Kolla Backgroud"></p><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>Kolla中使用到的技术栈总结如下。</p><ul><li>Docker，容器化基础工具</li><li>Ansible，配置管理，主要用于生成配置文件</li><li>Jinja，模板工具</li><li>Kubernetes/Mesos，Openstack社区或者说很多开源社区的特点就是：大而全的策略，可以预言：容器领域内所有火的组件慢慢都会在Kolla中出现，而且它们确实能组合出强大的功能。</li></ul><h3 id="Docker简介"><a href="#Docker简介" class="headerlink" title="Docker简介"></a>Docker简介</h3><p>Docker是通过Linux内核如LXC、namespace等实现的容器化技术。关于Docker的详细请参考docker系列文章或官方文档。<br><img src="/img/docker-internal.png" alt="docker内部组件"><br>通过Docker镜像，可以方便的对image进行版本管理。而且因为image的分层特性，体积较小，容易携带和分享。Docker的这些特性使得它非常适合于CI（持续集成/持续）/CD（持续部署/交付）系统，替换原来较重效率低得物理机或虚拟机方案。<br><img src="/img/docker-stages.png" alt="docker"><br>在Kolla中，用到了超权限容器（super privileged containers），因为部分组件直接访问宿主机的资源而不是使用自己的命名空间，如libvirt需要访问宿主机的网络空间来创建虚拟机。但是除非必要，对容器需要严格的权限控制以保证安全。<a href="http://developers.redhat.com/blog/2014/11/06/introducing-a-super-privileged-container-concept/" target="_blank" rel="external">参考</a></p><h3 id="Ansible简介"><a href="#Ansible简介" class="headerlink" title="Ansible简介"></a>Ansible简介</h3><h4 id="Ansible-组成"><a href="#Ansible-组成" class="headerlink" title="Ansible 组成"></a>Ansible 组成</h4><p>Ansible主要由以下部分组成：</p><ul><li>Inventory: 资产配置库,定义可管控的主机列表</li><li>Modules: core modules（自带模块）、custom modules(自定义模块)</li><li>Playbooks: 按照所设定编排的顺序执行完成安排任务</li></ul><p><img src="/img/ansible-arch.png" alt="ansible架构"></p><h4 id="Inventory"><a href="#Inventory" class="headerlink" title="Inventory"></a>Inventory</h4><p>资产配置文件,用来定义你要管理的主机,文件采用 INI 格式。</p><ul><li>被管理的机器可以通过其IP或域名指定</li><li>未分组的机器需保留在hosts的顶部</li><li>分组可以使用<code>[]</code>指定</li><li>分组也能嵌套</li><li>也可以通过数字和字母模式来指定一系列连续主机，支持从一些外围组件获取动态的Inventory,如Ansible Tower。</li></ul><h4 id="Playbook"><a href="#Playbook" class="headerlink" title="Playbook"></a>Playbook</h4><p>Playbook为YMAL格式，语法简单：</p><ul><li>在ansible中几乎所有的yaml文件都是以list开始,每个item是键值对的list。</li><li>所有的yaml文件都以<code>---</code>开头表示开始一个document,所有的列表元素以-开头,键值对用冒号,冒号后面的空格是必须的</li><li>键值对中的值如果是bool类型的字符串<code>true/false</code>(首字母不论大小写),会load成python中对应的bool值</li><li>在键值对中如果值中有冒号或者以两个大括号开头的变量定义,则必须用引号引起来</li></ul><p>Playbook由若干Play组成,每一个Play是对一个或一组主机进行一系列动作,Play从上到下依次执行,从而完成部署、配置和编排。每个Play大致结构如下:</p><ul><li>Host and Users – 指定操作的主机及使用的用户</li><li>Tasks – 每个Task有Name用于在执行时显示,及具体的Action调用module执行实际任务。</li><li>Handlers – 何时触发或notify触发别的动作,从而建立依赖关系一个Playbook文件可以通过include引入其他的yml文件,实现复用。</li></ul><h4 id="Roles"><a href="#Roles" class="headerlink" title="Roles"></a>Roles</h4><p>Ansible自1.2版本引入的新特性,用于层次性、结构化地组织Playbook。<br>Roles能够根据层次型结构自动装载变量文件、tasks以及handlers等。而要使用Roles只需要在Playbook中使用roles指令即可。<br>简单来讲,Roles就是通过分别将变量、文件、任务、模块及处理器放置于单独的目录中,并可以便捷地引用它们的一种机制。</p><h4 id="Best-Practise"><a href="#Best-Practise" class="headerlink" title="Best Practise"></a>Best Practise</h4><p>一个标准的目录结构如下图。<br><img src="/img/ansible-best-practise.png" alt="Ansible标准目录结构"></p><h2 id="Kolla"><a href="#Kolla" class="headerlink" title="Kolla"></a>Kolla</h2><p>基于上面的因素，结合容器技术近几年的快速发展，Openstack社区诞生了Kolla项目。<br>Kolla的使命如下：</p><blockquote><p>Kolla provides <strong>production-ready</strong> containers and deployment tools for operating OpenStack clouds.</p></blockquote><p>Kolla通过提供容器和Ansible的playbook来完成使命。Kolla被尽力设计为开箱即用，但又支持深度的自定义。这使得具有很少OpenStack经验的人员也可以轻易的部署并使用OpenStack，并随着经验的增长进行个性化定义以满足更高的需求。<br>Kolla不只简化了部署，也简化了操作。</p><h3 id="Kolla安装"><a href="#Kolla安装" class="headerlink" title="Kolla安装"></a>Kolla安装</h3><p>建议使用Mitaka之后的版本，因为M版本相对之前版本变动较大，之前基本相当于演示版本。<br>因项目变化很快，不做详述，请参考官方文档：<a href="http://docs.openstack.org/developer/kolla/quickstart.html" target="_blank" rel="external">kolla quickstart</a></p><h3 id="Kolla架构"><a href="#Kolla架构" class="headerlink" title="Kolla架构"></a>Kolla架构</h3><p><img src="/img/kolla-arch.png" alt="Kolla architecture"></p><p>其中绿色的组件是kolla提供的，蓝色组件由其它开源软件提供。<br>基本工作流如下：</p><ol><li>开发人员提交代码到gerrit，被review通过后merge至git</li><li>CD系统build出软件包（如RPM、DEB等）</li><li>CD系统使用软件包生成docker镜像</li><li>CD提交镜像到私有docker registry</li><li>CD系统触发节点上的镜像升级</li><li>Ansible下载最新镜像并更新容器，完成升级</li></ol><h2 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h2><p>比较重要的目录如下。</p><ul><li>ansible – ansible相关文件,包括资产配置文件、变量文件、扩展库、Roles、Playbooks</li><li>docker – docker 相关文件,主要包括 Dockerfile 和其它需要在 build 镜像时添加的文<br>件</li><li>etc – kolla 自己的配置文件</li><li>kolla – kolla 封装的工具,如 build.py 用于 build 镜像等</li><li>tools – 其它一些工具,部分已迁移至 kolla 目录,目前主要是一些开发测试用工具</li></ul><p>以下详细介绍。</p><h3 id="ansible"><a href="#ansible" class="headerlink" title="ansible"></a>ansible</h3><p>此目录下是一个标准的 ansible 项目,主要包含如下目录及文件。</p><ul><li>action_plugins – action 扩展插件</li><li>group_vars – 全局变量</li><li>inventory – 资产配置文件,主要包含 all-in-one 和 multinode 两个,实际环境中使用时需要保证主机名的正确对应。</li><li>library – 扩展 ansible module</li><li>roles – 每个模块对应的 role</li><li>*.yml - 若干 Playbook,其中针对 zeus,编写了单独的 Playbook,执行需要通过-p 指</li></ul><p>我们需要在 roles 目录下添加对应的 role,使用了官方推荐的目录结构,其中一个 role 的结构如 下:</p><ul><li>defaults – 变量默认值</li><li>meta – 依赖</li><li>tasks–task列表,入口在main.yml,目前支持的action包括deploy、pull、upgrade、reconfigure,每个 action 对应一个 task 文件。</li><li>templates – 使用到的配置文件模板,及生成 config.json 需要的模板文件。</li></ul><p>需要注意一个叫做 common 的 role,其它的 role 大多依赖它,其中包含的内容有:</p><ul><li>kolla-toolbox – 其中装有所有 client,主要用来注册 endpoint 和操作数据库</li><li>heka – 用来收集日志,Docker 镜像 build 时需要去 s3 下载 rpm 包,已被墙</li><li>cron – 用来执行定时任务<br>设置配置项 common_run: True,可以指定不执行 common 相关的任务,但没找到有选项去具体控制使用哪个组件。<br>kolla-toolbox是我们必须的。所以只能使用代码注释的办法,注释掉 heka 和 cron 相关代码。</li></ul><h3 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h3><p>此目录下主要为各模块对应的Dockerfile模板及其它build镜像时需要的文件。<br>Dockerfile模板使用的是Jinja2 模板,其中包含变量,用于根据参数判断,在部署时由ansible 根据参数及配置动态生成。<br>基础镜像在 base 目录下,其中主要是基本配置及安装基本软件包。其余镜像基本集成自base。<br>如果具体组件依赖不同,可自定义base镜像使用。<br>Docker镜像中用到两个比较重要的脚本:start.sh(base)和 extend_start.sh(具体镜像),其作用及实现原理见第 5 节。</p><h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><p>使用 kolla 时,我们一般不直接使用 docker 及 ansible,而是使用封装后的命令:</p><ul><li>kolla/cmd/build.py – 用于 build 镜像,对 <code>docker build</code> 进行了封装</li><li>tools/kolla-ansible – 对 ansible 的封装</li></ul><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>推荐使用的依赖版本,其它版本可能会有各种问题。</p><ul><li>操作系统 – 推荐宿主机器使用centos7。centos6下经过一番折腾也能安装成功，但是各种问题真心不建议使用，或者升级内核。如果有需要可以在容器内运行centos6。</li><li>Docker版本 – 推荐从docker官网安装新版本。</li><li>Ansible – 1.9.4</li><li>Docker Python – 1.6.0</li></ul><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><h3 id="添加配置项"><a href="#添加配置项" class="headerlink" title="添加配置项"></a>添加配置项</h3><ul><li><code>roles/templates/*.j2</code> – 一般是在配置文件中使用,配置文件一般为Jinja模板,使用类似Django模板的语法</li><li><code>roles/defaults/main.yml</code> – 配置默认值</li><li><code>group_vars/all.yml</code> – 全局默认值</li><li><code>globals.yml</code>或<code>passwords.yml</code>中。</li></ul><p>另外,在config.yml的对应任务中也可以看到,在实际生成配置文件时,还用到了其它一些文件,<br>如Nova下:</p><ul><li><code>/etc/kolla/config/global.conf</code></li><li><code>/etc/kolla/config/database.conf</code></li><li><code>/etc/kolla/config/messaging.conf</code></li><li><code>/etc/kolla/config/nova.conf</code></li><li><code>/etc/kolla/config/nova/.conf</code></li></ul><p>也可以在这些文件中添加配置,而覆盖ansible生成的配置,或添加缺少的配置。</p><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>以cinder-api为例：<br></p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><div class="line"><span class="keyword">FROM</span> &#123;&#123; namespace &#125;&#125;/&#123;&#123; image_prefix &#125;&#125;cinder-base:&#123;&#123; tag &#125;&#125;</div><div class="line"><span class="keyword">MAINTAINER</span> &#123;&#123; <span class="keyword">maintainer</span> &#125;&#125;</div><div class="line"></div><div class="line">&#123;% if install_type == 'binary' %&#125;</div><div class="line">    &#123;% if base_distro in ['centos', 'fedora', 'oraclelinux', 'rhel'] %&#125;</div><div class="line"></div><div class="line"><span class="keyword">RUN</span> <span class="bash">yum install -y python-keystone \</span></div><div class="line">  &amp;&amp; yum clean all</div><div class="line"></div><div class="line">    &#123;% elif base_distro in ['ubuntu'] %&#125;</div><div class="line"></div><div class="line"><span class="keyword">RUN</span> <span class="bash">apt-get install -y --no-install-recommends \</span></div><div class="line">        cinder-api \</div><div class="line">    &amp;&amp; apt-get clean</div><div class="line"></div><div class="line">    &#123;% endif %&#125;</div><div class="line">&#123;% endif %&#125;</div><div class="line"></div><div class="line"><span class="keyword">COPY</span> <span class="bash">extend_start.sh /usr/<span class="built_in">local</span>/bin/kolla_cinder_extend_start</span></div><div class="line"><span class="keyword">RUN</span> <span class="bash">chmod 755 /usr/<span class="built_in">local</span>/bin/kolla_cinder_extend_start</span></div><div class="line"></div><div class="line">&#123;&#123; include_footer &#125;&#125;</div><div class="line"></div><div class="line"><span class="keyword">USER</span> cinder</div></pre></td></tr></table></figure><p></p><p>其中除了设置相关信息外，还做了这些事：</p><ol><li>继承cinder-base<br>cinder-base位于kolla/docker/cinder/cinder-base目录下。<br>cinder-base继承自openstack-base，openstack-base继承自base。<br>base中主要安装基础包（如python）、设置源、执行set_configs.py（验证并通过config.json生成配置文件）、执行start.sh。<br>openstack-base中主要做大多数服务通用的动作，如安装openstack的基础依赖包等。<br>cinder-base中主要做cinder服务通用的动作，如安装cinder-common、设置sudoer文件等。<br>同时我们看到对docker的tag的支持。</li><li>安装软件包<br>通过识别操作系统类型，安装对应的包。<br>如果研究下cinder-base的内容，可看到对源码安装的支持。</li><li>执行需要的命令<br>base中设置了通过CMD执行start.sh。cinder-base中通过CMD执行extend_start.sh。<br>其中服务的启动主要在start.sh中，而需要的其它工作如db_sync主要在extend_start中执行。</li></ol><h3 id="Playbook-Role"><a href="#Playbook-Role" class="headerlink" title="Playbook/Role"></a>Playbook/Role</h3><p>TODO</p><h2 id="配置及部署"><a href="#配置及部署" class="headerlink" title="配置及部署"></a>配置及部署</h2><p>在部署时，我们主要配置哪些文件呢？</p><ul><li>globals.yml<br>其中配置必须的变量,但一般不包含密码。</li><li>passwords.yml<br>其中配置需要的密码。</li><li><p>资产配置文件<br>ansible/inventory目录下，使用主机名指定，在实际使用时需要保证主机名的对应。也可根据实际需要进行主机、分组等的调整。另一个可能使用到的是禁用某个组件，如禁用ceilometer-compute:</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># disable by default</div><div class="line">[ceilometer-compute:children]</div><div class="line">#ceilometer</div></pre></td></tr></table></figure></li><li><p>kolla-build.conf<br>指定 build 使用的源,可以使用 rpm 包或 repo 文件。<br>如不知道会使用 delorean 源,其内容为社区最近 build 出的 master 分支的 RPM 包: Delorean is a tool to build rpm packages on each commit of a set of git repositories. 建议根据需要指定使用rdo的源。<br>在 build 时通过–config-file=参数指定使用的 kolla-build.conf。</p></li></ul><h2 id="项目现状"><a href="#项目现状" class="headerlink" title="项目现状"></a>项目现状</h2><p>TODO</p><h2 id="参考索引"><a href="#参考索引" class="headerlink" title="参考索引"></a>参考索引</h2><ul><li><a href="https://github.com/openstack/kolla" target="_blank" rel="external">Kolla项目github地址</a></li><li><a href="http://docs.openstack.org/developer/kolla/index.html" target="_blank" rel="external">Openstack Kolla Docs</a></li><li><a href="http://www.slideshare.net/daneyonhansen/openstack-kolla-introduction" target="_blank" rel="external">Kolla Introduction PPT</a></li><li><a href="https://www.ansible.com/blog/openstack-kolla" target="_blank" rel="external">Openstack Kolla: Dependency Management Done Right With Docker And Ansible</a></li><li><a href="https://allthingsopen.com/2014/10/22/a-demonstration-of-kolla-docker-and-kubernetes-based-deployment-of-openstack-services-on-atomic/" target="_blank" rel="external">A Demonstration of Kolla: Docker and Kubernetes based Deployment</a></li><li><a href="http://www.chenshake.com/openstack-project-series-2-kolla/" target="_blank" rel="external">陈沙克日志对Kolla介绍</a></li></ul></div><div></div><div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/docker/" rel="tag">#docker</a> <a href="/tags/openstack/" rel="tag">#openstack</a> <a href="/tags/kolla/" rel="tag">#kolla</a> <a href="/tags/容器化/" rel="tag">#容器化</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2016/03/kolla-service-process/" rel="next" title="Kolla中服务启动实现分析"><i class="fa fa-chevron-left"></i> Kolla中服务启动实现分析</a></div><div class="post-nav-prev post-nav-item"> <a href="/2016/07/fresh-start/" rel="prev" title="新域名启用">新域名启用<i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"><div class="jiathis_style"><a class="jiathis_button_tsina"></a><a class="jiathis_button_tqq"></a><a class="jiathis_button_weixin"></a><a class="jiathis_button_cqq"></a><a class="jiathis_button_douban"></a><a class="jiathis_button_renren"></a><a class="jiathis_button_qzone"></a><a class="jiathis_button_kaixin001"></a><a class="jiathis_button_copy"></a><a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script></div></div></div><div class="comments" id="comments"><div class="ds-thread" data-thread-key="2016/03/openstack-kolla-intro/" data-title="Kolla：Openstack容器化部署简介" data-url="http://stackeye.com/2016/03/openstack-kolla-intro/"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/img/avatar.jpg" alt="Jacob"><p class="site-author-name" itemprop="name">Jacob</p><p class="site-description motion-element" itemprop="description">软件工程师的自我修养</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">27</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories"><span class="site-state-item-count">8</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags"><span class="site-state-item-count">38</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#为什么要做容器化部署"><span class="nav-number">1.</span> <span class="nav-text">为什么要做容器化部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Openstack之美"><span class="nav-number">1.1.</span> <span class="nav-text">Openstack之美</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Openstack之殇"><span class="nav-number">1.2.</span> <span class="nav-text">Openstack之殇</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#容器的崛起"><span class="nav-number">1.3.</span> <span class="nav-text">容器的崛起</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基础知识"><span class="nav-number">2.</span> <span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker简介"><span class="nav-number">2.1.</span> <span class="nav-text">Docker简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ansible简介"><span class="nav-number">2.2.</span> <span class="nav-text">Ansible简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Ansible-组成"><span class="nav-number">2.2.1.</span> <span class="nav-text">Ansible 组成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Inventory"><span class="nav-number">2.2.2.</span> <span class="nav-text">Inventory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Playbook"><span class="nav-number">2.2.3.</span> <span class="nav-text">Playbook</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Roles"><span class="nav-number">2.2.4.</span> <span class="nav-text">Roles</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Best-Practise"><span class="nav-number">2.2.5.</span> <span class="nav-text">Best Practise</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kolla"><span class="nav-number">3.</span> <span class="nav-text">Kolla</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Kolla安装"><span class="nav-number">3.1.</span> <span class="nav-text">Kolla安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kolla架构"><span class="nav-number">3.2.</span> <span class="nav-text">Kolla架构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码结构"><span class="nav-number">4.</span> <span class="nav-text">代码结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ansible"><span class="nav-number">4.1.</span> <span class="nav-text">ansible</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker"><span class="nav-number">4.2.</span> <span class="nav-text">docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tools"><span class="nav-number">4.3.</span> <span class="nav-text">Tools</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#依赖"><span class="nav-number">4.4.</span> <span class="nav-text">依赖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实例"><span class="nav-number">5.</span> <span class="nav-text">实例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#添加配置项"><span class="nav-number">5.1.</span> <span class="nav-text">添加配置项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dockerfile"><span class="nav-number">5.2.</span> <span class="nav-text">Dockerfile</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Playbook-Role"><span class="nav-number">5.3.</span> <span class="nav-text">Playbook/Role</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置及部署"><span class="nav-number">6.</span> <span class="nav-text">配置及部署</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#项目现状"><span class="nav-number">7.</span> <span class="nav-text">项目现状</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考索引"><span class="nav-number">8.</span> <span class="nav-text">参考索引</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2012 - <span itemprop="copyrightYear">2016</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Jacob</span></div><div class="powered-by"> 由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动</div><div class="theme-info"> 主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script><script type="text/javascript">var duoshuoQuery={short_name:"stackeye"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.id="duoshuo-script",t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script><script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script><script src="/js/src/hook-duoshuo.js"></script></body></html>
<!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="shell,ansible,linux,"><meta name="description" content="人不为己，天诛地灭。直到这一天，某个进程也决定要这么去做。而你，也决定做个幕后黑手，助他一臂之力。 需求指定一个文件路径，所有访问这个文件的进程，除目标进程外，全部杀掉。因为自己也在访问这个文件，所以不能直接lsof后全部杀死。而因为系统机制，父进程及祖先进程也不能杀死。而子进程可能是目标进程启动的子任务，因此也不能杀死。悲催的是，pstree等第三包的命令不允许使用。 基本方法不能杀死父进程，以"><meta name="keywords" content="shell,ansible,linux"><meta property="og:type" content="article"><meta property="og:title" content="杀死那些与我没有亲缘关系的进程"><meta property="og:url" content="http://bingostack.com/2021/04/kill-all-pids-except-my-relatives/index.html"><meta property="og:site_name" content="BingoStack"><meta property="og:description" content="人不为己，天诛地灭。直到这一天，某个进程也决定要这么去做。而你，也决定做个幕后黑手，助他一臂之力。 需求指定一个文件路径，所有访问这个文件的进程，除目标进程外，全部杀掉。因为自己也在访问这个文件，所以不能直接lsof后全部杀死。而因为系统机制，父进程及祖先进程也不能杀死。而子进程可能是目标进程启动的子任务，因此也不能杀死。悲催的是，pstree等第三包的命令不允许使用。 基本方法不能杀死父进程，以"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2021-04-05T02:14:35.272Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="杀死那些与我没有亲缘关系的进程"><meta name="twitter:description" content="人不为己，天诛地灭。直到这一天，某个进程也决定要这么去做。而你，也决定做个幕后黑手，助他一臂之力。 需求指定一个文件路径，所有访问这个文件的进程，除目标进程外，全部杀掉。因为自己也在访问这个文件，所以不能直接lsof后全部杀死。而因为系统机制，父进程及祖先进程也不能杀死。而子进程可能是目标进程启动的子任务，因此也不能杀死。悲催的是，pstree等第三包的命令不允许使用。 基本方法不能杀死父进程，以"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://bingostack.com/2021/04/kill-all-pids-except-my-relatives/"><title>杀死那些与我没有亲缘关系的进程 | BingoStack</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?9c95a77f4ec2c33edff8095251aef97d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">BingoStack</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Long way to full stack!</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://bingostack.com/2021/04/kill-all-pids-except-my-relatives/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="bingostack"><meta itemprop="description" content><meta itemprop="image" content="/img/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="BingoStack"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">杀死那些与我没有亲缘关系的进程</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-04T21:51:51+08:00">2021-04-04</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于&#58;</span> <time title="更新于" itemprop="dateModified" datetime="2021-04-05T10:14:35+08:00">2021-04-05</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux工具/" itemprop="url" rel="index"><span itemprop="name">linux工具</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux工具/shell/" itemprop="url" rel="index"><span itemprop="name">shell</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">1.5k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">6</span></div></div></header><div class="post-body" itemprop="articleBody"><p>人不为己，天诛地灭。<br>直到这一天，某个进程也决定要这么去做。<br>而你，也决定做个幕后黑手，助他一臂之力。</p><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>指定一个文件路径，所有访问这个文件的进程，除目标进程外，全部杀掉。<br>因为自己也在访问这个文件，所以不能直接<code>lsof</code>后全部杀死。<br>而因为系统机制，父进程及祖先进程也不能杀死。<br>而子进程可能是目标进程启动的子任务，因此也不能杀死。<br>悲催的是，pstree等第三包的命令不允许使用。</p><h2 id="基本方法"><a href="#基本方法" class="headerlink" title="基本方法"></a>基本方法</h2><p>不能杀死父进程，以及祖先进程，否则可能会被一窝端。<br>也不能杀死子孙进程：不孝有三，无后为大。<br>但是叔叔辈、伯伯辈以及他们的子孙分支，那就只能 say sorry 了。<br><a id="more"></a></p><h3 id="祖先进程"><a href="#祖先进程" class="headerlink" title="祖先进程"></a>祖先进程</h3><p>典型的比如 shell 脚本与父进程 bash。<br>而我们知道，<code>ps -ef</code> 不仅能显示所有进程信息（包含PID），还会显示父进程（PPID）。<br>因此找到某个进程的所有前代进程很简单：<br>进程-&gt;父进程-&gt;爷进程-&gt;太爷进程-&gt;…-&gt;祖宗进程（PID为1，个别为0）。<br>也即按照此链路一直往上找，直到PID为0或1。<br>简单通过一个map即可实现。</p><h3 id="子孙进程"><a href="#子孙进程" class="headerlink" title="子孙进程"></a>子孙进程</h3><p>很典型的例子是一个 shell 脚本，基本命令、tee日志等都会启动子进程。<br>而找到子孙进程要稍微复杂一些，毕竟开枝散叶了嘛。<br>原始进程我们称之为目标进程。在 shell 中，可以通过<code>$$</code>获取到自己的PID。<br>我们对随便一个PID按照上面相同的路径向上寻找，会有两种可能：</p><ol><li>找到了1或0：此进程不是目标进程的子孙进程。可能和目标进程没关系，或者是它的祖先进程。</li><li>找到了目标进程：是目标进程的子孙进程，属于保护目标。</li></ol><h3 id="使用命令"><a href="#使用命令" class="headerlink" title="使用命令"></a>使用命令</h3><p>简单的使用shell命令实现即可。<br>其实如果有 <code>pstree</code>及类似命令，一条命令即可解决。但奈何不允许装这个包。<br>注意使用 lsof 和 ps 命令实现。</p><h4 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h4><p><code>lsof</code> 查找访问文件的全部进程，可获取到PID。<br><code>lsof +D</code>还会搜索目录下的目录。<br>如果文件不存在，lsof 会报错，因此可以先检查。<br>简单看了下，没找到能直接去掉 header 的选项。那就解析时过滤吧。</p><h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><p><code>ps -ef</code> 查找所有的进程及与父进程的对应关系。<br>–noheaders 可以去掉 header。(MAC下不行)<br>但是发现指定列后，显示的进程不全了，可以继续深究下。</p><h4 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h4><p>暴力一点，<code>kill -9</code> 即可。<br>但需要注意，一些进程，比如lsof自身，只短暂存在。<br>考虑到代码执行时间很短，忽略掉误杀其它进程的情况。<br>但是要考虑kill不存在的进程导致的报错。</p><h2 id="遗留问题"><a href="#遗留问题" class="headerlink" title="遗留问题"></a>遗留问题</h2><h3 id="screen-抱养之后的问题"><a href="#screen-抱养之后的问题" class="headerlink" title="screen 抱养之后的问题"></a>screen 抱养之后的问题</h3><p>测试发现，screen 运行有个特殊问题，可称之为“抱养”的场景。<br>总结一句话：从 screen detach后，screen的父进程会变为1。<strong>因此在screen内运行此脚本，会导致外面的shell被杀。但是screen不会被杀，其内运行的脚本也不会受影响</strong>。但是使用者会被退出终端，ssh断开连接等。</p><p>场景如下：</p><ol><li><p><code>screen -S test</code>，之后在screen内 <code>ps -ef</code> 可看到，screen进程的PPID为之前的bash进程</p></li><li><p>在screen内运行 <code>bash test.sh</code>，此脚本内容就是简单打印自己PID然后睡眠:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $$</span><br><span class="line">sleep 999999</span><br></pre></td></tr></table></figure></li><li><p>从screen detach出来，<code>ps -ef</code> 可看到，screen进程的PPID变为了1！<br>脱离父子关系！好绝情！<br>但也可以理解，screen要在外层shell退出之后依然运行。它实在忍受不了这个不靠谱的爹了。</p></li><li><p>再次screen -x test 来attach进去，执行脚本，发现父进程是之前的screen -S！</p></li></ol><p>这种情况下，在 screen 内执行脚本，除非<code>screen -S</code>未detach过，否则会有问题。<br>但是万幸的是，脚本执行不会被中断。</p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>python+shell实现方式如下。<br></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo "my PID: $$"</span><br><span class="line">python kill_non_relatives.py $$</span><br><span class="line">echo "finish"</span><br></pre></td></tr></table></figure><p></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找具有祖先进程和子孙进程，错误返回None</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_related_pids</span><span class="params">(target_pid)</span>:</span></span><br><span class="line">    ps_command = subprocess.Popen(<span class="string">"ps -ef --noheaders|awk '&#123;print $2,$3&#125;'"</span>,</span><br><span class="line">        shell=<span class="literal">True</span>, stdout=subprocess.PIPE)</span><br><span class="line">    ps_output = ps_command.stdout.readlines()</span><br><span class="line">    retcode = ps_command.wait()</span><br><span class="line">    <span class="keyword">assert</span> retcode == <span class="number">0</span>, <span class="string">"ps command returned %d"</span> % retcode</span><br><span class="line"></span><br><span class="line">    pid_to_ppid = &#123;&#125; <span class="comment"># PID:PPID</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> ps_output:</span><br><span class="line">        items = line.split()</span><br><span class="line">        <span class="keyword">if</span> len(items) != <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"parse ps -ef error"</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># print items[0],items[1]</span></span><br><span class="line">        pid_to_ppid[int(items[<span class="number">0</span>])] = int(items[<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># print pid_to_ppid</span></span><br><span class="line"></span><br><span class="line">    ppid_map = &#123;&#125; <span class="comment"># save all PPID</span></span><br><span class="line">    cpid_map = &#123;&#125; <span class="comment"># save all child PID</span></span><br><span class="line">    <span class="keyword">if</span> target_pid <span class="keyword">not</span> <span class="keyword">in</span> pid_to_ppid:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"not found"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    pid = pid_to_ppid[target_pid]</span><br><span class="line">    ppid_map[pid] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> pid &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> pid <span class="keyword">not</span> <span class="keyword">in</span> pid_to_ppid:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        pid = pid_to_ppid[pid]</span><br><span class="line">        ppid_map[pid] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"parent pids:"</span>, ppid_map.keys()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> pid,ppid <span class="keyword">in</span> pid_to_ppid.items():</span><br><span class="line">        <span class="keyword">if</span> pid == target_pid <span class="keyword">or</span> pid <span class="keyword">in</span> ppid_map: <span class="comment"># 过滤父进程</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">while</span> ppid &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># 父进程为目标进程，或目标进程的子孙进程</span></span><br><span class="line">            <span class="keyword">if</span> ppid == target_pid <span class="keyword">or</span> ppid <span class="keyword">in</span> cpid_map:</span><br><span class="line">                cpid_map[pid] = <span class="number">0</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        ppid = pid_to_ppid[ppid]</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"child pids:"</span>, cpid_map.keys()</span><br><span class="line">    <span class="keyword">return</span> list(set([target_pid] +ppid_map.keys()+cpid_map.keys()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 杀死访问target_file的所有进程，自己及进程树上下游除外</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">kill_non_relatives</span><span class="params">(target_file, parent_pid)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"kill_non_relatives: target_file(%s), parent_pid(%d)"</span> % (target_file, parent_pid)</span><br><span class="line">    <span class="comment"># 一定要注意grep为空的情况、文件不存在的情况，返回值为非0</span></span><br><span class="line">    lsof_command = subprocess.Popen(<span class="string">"[[ -e %s ]] &amp;&amp; lsof +D %s|awk '&#123;print $2&#125;'||:"</span> % (</span><br><span class="line">        target_file, target_file), shell=<span class="literal">True</span>, stdout=subprocess.PIPE)</span><br><span class="line">    lsof_output = lsof_command.stdout.readlines()</span><br><span class="line">    retcode = lsof_command.wait()</span><br><span class="line">    <span class="keyword">assert</span> retcode == <span class="number">0</span>, <span class="string">"lsof command returned %d"</span> % retcode</span><br><span class="line"></span><br><span class="line">    white_pids = find_related_pids(parent_pid)</span><br><span class="line">    <span class="keyword">if</span> white_pids <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"find_related_pids error!"</span></span><br><span class="line">        sys.exit(<span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> ps_output:</span><br><span class="line">        line = line.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line.isdigit():</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        pid = int(line)</span><br><span class="line">        <span class="keyword">if</span> pid <span class="keyword">not</span> <span class="keyword">in</span> white_pids:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"will kill %d"</span> % pid</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                os.kill(pid, signal.SIGKILL)</span><br><span class="line">            <span class="keyword">except</span> OSError:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">"kill %d failed"</span> % pid</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"skip kill %d"</span> % pid</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 参数：目标文件路径 目标进程PID</span></span><br><span class="line">    kill_non_relatives(sys.argv[<span class="number">1</span>], int(sys.argv[<span class="number">2</span>]))</span><br></pre></td></tr></table></figure><h2 id="其它方式"><a href="#其它方式" class="headerlink" title="其它方式"></a>其它方式</h2><ul><li>pstree 拿到进程树</li><li>读取系统文件等方式，解析出进程树</li><li>拷贝执行文件到其它目录等方式，保证自己不会访问这个目录，然后直接全部杀掉</li></ul></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> bingostack</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="http://bingostack.com/2021/04/kill-all-pids-except-my-relatives/" title="杀死那些与我没有亲缘关系的进程">http://bingostack.com/2021/04/kill-all-pids-except-my-relatives/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/shell/" rel="tag"># shell</a> <a href="/tags/ansible/" rel="tag"># ansible</a> <a href="/tags/linux/" rel="tag"># linux</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2021/03/ansible-shell-command/" rel="next" title="使用ansible执行shell命令的正确姿势"><i class="fa fa-chevron-left"></i> 使用ansible执行shell命令的正确姿势</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></div></article><div class="post-spread"><div class="jiathis_style"> <span class="jiathis_txt">分享到：</span> <a class="jiathis_button_fav">收藏夹</a> <a class="jiathis_button_copy">复制网址</a> <a class="jiathis_button_email">邮件</a> <a class="jiathis_button_weixin">微信</a> <a class="jiathis_button_qzone">QQ空间</a> <a class="jiathis_button_tqq">腾讯微博</a> <a class="jiathis_button_douban">豆瓣</a> <a class="jiathis_button_share">一键分享</a> <a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a><a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,summary:"",shortUrl:!1,hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/img/avatar.jpg" alt="bingostack"><p class="site-author-name" itemprop="name">bingostack</p><p class="site-description motion-element" itemprop="description">软件工程师的自我修养</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">14</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">55</span> <span class="site-state-item-name">标签</span></a></div></nav></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#需求"><span class="nav-number">1.</span> <span class="nav-text">需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本方法"><span class="nav-number">2.</span> <span class="nav-text">基本方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#祖先进程"><span class="nav-number">2.1.</span> <span class="nav-text">祖先进程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子孙进程"><span class="nav-number">2.2.</span> <span class="nav-text">子孙进程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用命令"><span class="nav-number">2.3.</span> <span class="nav-text">使用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#lsof"><span class="nav-number">2.3.1.</span> <span class="nav-text">lsof</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ps"><span class="nav-number">2.3.2.</span> <span class="nav-text">ps</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#kill"><span class="nav-number">2.3.3.</span> <span class="nav-text">kill</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#遗留问题"><span class="nav-number">3.</span> <span class="nav-text">遗留问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#screen-抱养之后的问题"><span class="nav-number">3.1.</span> <span class="nav-text">screen 抱养之后的问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码实现"><span class="nav-number">4.</span> <span class="nav-text">代码实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其它方式"><span class="nav-number">5.</span> <span class="nav-text">其它方式</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">bingostack</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">62.1k</span></div><div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script></body></html>